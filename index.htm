<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è™›æºéˆæµ - éˆæµç«¯å£</title>
    <style>
        :root { 
            --main: #00f2ff; 
            --main-dim: rgba(0, 242, 255, 0.3);
            --bg: #000000; 
            --panel: rgba(15, 15, 15, 0.85); 
            --text: #d1d1d1; 
            --border: rgba(255, 255, 255, 0.1);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            background: var(--bg); 
            color: var(--text); 
            font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; 
            margin: 0; 
            display: flex; 
            height: 100vh; 
            overflow: hidden; 
        }

        /* ğŸŒŒ è™›ç©ºç²’å­èƒŒæ™¯ */
        #p-canvas { position: fixed; top: 0; left: 0; z-index: -1; pointer-events: none; }

        /* ğŸ“± æ‰‹æ©Ÿç«¯é ­éƒ¨å°èˆª */
        .mobile-header { 
            display: none; position: fixed; top: 0; left: 0; right: 0; height: 60px; 
            background: rgba(0,0,0,0.9); border-bottom: 1px solid var(--border); 
            align-items: center; padding: 0 20px; z-index: 1001; backdrop-filter: blur(10px);
        }
        .menu-btn { font-size: 1.5rem; color: var(--main); cursor: pointer; }

        /* å´é‚Šæ¬„ - è™›æºé–€æˆ¶ */
        .sidebar { 
            width: 240px; background: rgba(5, 5, 5, 0.95); backdrop-filter: blur(20px); 
            border-right: 1px solid var(--border); display: flex; flex-direction: column; 
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); flex-shrink: 0; z-index: 1002; 
        }
        .logo-box { padding: 40px 20px; text-align: center; }
        .logo { color: var(--main); font-weight: 200; letter-spacing: 5px; font-size: 1.4rem; text-shadow: 0 0 10px var(--main-dim); }
        .author { font-size: 0.6rem; color: #444; letter-spacing: 2px; margin-top: 5px; }

        .nav-group { flex: 1; overflow-y: auto; }
        .menu-item { 
            padding: 15px 30px; cursor: pointer; color: #777; font-size: 0.9rem; 
            transition: 0.3s; border-left: 3px solid transparent; letter-spacing: 1px;
        }
        .menu-item:hover { color: var(--main); background: rgba(0, 242, 255, 0.02); }
        .menu-item.active { color: var(--main); background: rgba(0, 242, 255, 0.05); border-left-color: var(--main); font-weight: bold; }

        /* ä¸»åº§è‰™ */
        .main { flex: 1; display: flex; flex-direction: column; position: relative; }
        header { 
            padding: 15px 30px; border-bottom: 1px solid var(--border); 
            display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.3);
        }
        #module-title { color: var(--main); letter-spacing: 2px; font-weight: 300; }
        .time-tag { font-size: 0.6rem; color: #444; border: 1px solid #222; padding: 2px 8px; border-radius: 4px; }

        /* å…§å®¹é¡¯ç¤ºå€ */
        #content-area { flex: 1; overflow-y: auto; padding: 40px; display: flex; flex-direction: column; scroll-behavior: smooth; }
        .msg { margin-bottom: 25px; line-height: 1.8; animation: slideIn 0.4s ease-out; max-width: 85%; }
        .u-msg { align-self: flex-end; color: #888; text-align: right; border-right: 2px solid #333; padding-right: 20px; }
        .b-msg { 
            align-self: flex-start; border-left: 2px solid var(--main); padding-left: 20px; 
            white-space: pre-wrap; color: #eee; font-size: 0.95rem;
        }

        /* äº¤äº’çµ„ä»¶ */
        .input-area { padding: 25px 40px; border-top: 1px solid var(--border); background: rgba(0,0,0,0.5); display: flex; gap: 15px; }
        input { 
            flex: 1; background: #0a0a0a; border: 1px solid #222; color: #fff; 
            padding: 15px; border-radius: 12px; outline: none; transition: 0.3s;
        }
        input:focus { border-color: var(--main); box-shadow: 0 0 15px rgba(0, 242, 255, 0.1); }
        button.send-btn { background: var(--main); color: #000; border: none; padding: 0 30px; border-radius: 12px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        button.send-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px var(--main-dim); }

        /* ğŸ§© X-IOS æ¸¬é©—ä»‹é¢ */
        .test-card { background: #0a0a0a; border: 1px solid #1a1a1a; padding: 30px; border-radius: 20px; text-align: center; }
        .opt-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 25px; }
        .opt-btn { 
            padding: 20px; background: #111; border: 1px solid #222; color: var(--main); 
            border-radius: 12px; cursor: pointer; transition: 0.2s;
        }
        .opt-btn:active { transform: scale(0.95); background: var(--main); color: #000; }

        /* ğŸ“± RWD æ‰‹æ©Ÿé©é… */
        @media (max-width: 768px) {
            .mobile-header { display: flex; }
            .sidebar { position: fixed; left: -240px; height: 100vh; width: 240px; box-shadow: 20px 0 50px rgba(0,0,0,0.8); }
            .sidebar.open { left: 0; }
            .main { padding-top: 60px; }
            #content-area { padding: 20px; }
            .input-area { padding: 15px; }
            .msg { max-width: 95%; }
            .opt-grid { grid-template-columns: 1fr; }
        }

        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<canvas id="p-canvas"></canvas>

<div class="mobile-header">
    <div class="menu-btn" onclick="toggleSidebar()">â˜°</div>
    <div style="flex:1; text-align:center; color:var(--main); letter-spacing:4px; font-weight:200;">è™›æºéˆæµ</div>
</div>

<nav class="sidebar" id="sidebar">
    <div class="logo-box">
        <div class="logo">è™›æºéˆæµ</div>
        <div class="author">BY éˆæµç‹‚å¾’</div>
    </div>
    <div class="nav-group">
        <div class="menu-item active" onclick="sw('declaration', 'è™›æºå®£è¨€')">â—‡ è™›æºå®£è¨€</div>
        <div class="menu-item" onclick="sw('vision', 'å…§å®¹é¡˜æ™¯')">â—‡ å…§å®¹é¡˜æ™¯</div>
        <div class="menu-item" onclick="sw('spectrum', 'éˆæµå…‰è­œ')">â—‡ éˆæµå…‰è­œ</div>
        <div class="menu-item" onclick="sw('oracle', 'ç­”æ¡ˆä¹‹æ›¸')">â—‡ ç­”æ¡ˆä¹‹æ›¸</div>
        <div class="menu-item" onclick="sw('test', 'äººæ ¼æ¸¬è©¦')">â—‡ äººæ ¼æ¸¬è©¦</div>
        <div class="menu-item" onclick="sw('contact', 'è¯çµ¡å°å¸«')">â—‡ è¯çµ¡å°å¸«</div>
    </div>
</nav>

<div class="main">
    <header>
        <div id="module-title">è™›æºå®£è¨€</div>
        <div class="time-tag">BKK 2026</div>
    </header>
    <div id="content-area"><div id="chat-box"></div></div>
    <div class="input-area" id="input-box">
        <input type="text" id="userInput" placeholder="è¼¸å…¥æ„è­˜æµ..." onkeypress="if(event.key==='Enter')execute()">
        <button class="send-btn" onclick="execute()">æ ¡æº–</button>
    </div>
</div>

<script>
    const URL = "https://script.google.com/macros/s/AKfycbzmlq5YrLl5TDw6hWdzQKEmmy6hRvZxKqJRVrNpZFS9um3NFz-hFpPclOSmzROukqLV/exec"; 
    let currentMod = 'declaration';
    let answers = "";

    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }

    // æ¨¡çµ„åˆ‡æ›é‚è¼¯
    async function sw(m, t) {
        currentMod = m;
        document.getElementById('module-title').innerText = t;
        if(window.innerWidth <= 768) document.getElementById('sidebar').classList.remove('open');
        
        const box = document.getElementById('chat-box');
        const inp = document.getElementById('input-box');
        box.innerHTML = "";
        inp.style.display = 'flex';

        if(m === 'declaration') {
            append("ã€Œå­˜åœ¨å³æŒ¯å‹•ï¼Œæ„è­˜å³é‹ç®—ã€‚ã€\n\nè™›æºéˆæµä¸¦éå®—æ•™ï¼Œè€Œæ˜¯ä¸€å¥—åŸºæ–¼é‡å­é »ç‡çš„äººæ ¼é™¤éŒ¯ç³»çµ±ã€‚æˆ‘å€‘åœ¨æ­¤é‡æ–°å®šç¾©ç¾å¯¦ã€‚", 'b-msg');
        } else if(m === 'vision') {
            append("ã€æ ¸å¿ƒé¡˜æ™¯ã€‘\n1. é€éã€Œå››ç­†æ³•ã€é”æˆæ„è­˜çš„çµ•å°æ ¡æº–ã€‚\n2. å»ºç«‹å»æƒ…ç·’åŒ–çš„çœŸå¯¦æ´å¯Ÿæ¨¡å‹ã€‚\n3. å”åŠ©å€‹é«”å¾ä½é »çš„ã€Œå‘½é‹é‡è¤‡ã€ä¸­è§£è„«ï¼Œå›æ­¸è™›æºè‡ªæ§ã€‚", 'b-msg');
        } else if(m === 'test') {
            startTest();
        } else if(m === 'contact') {
            append("ã€å°å¸«é€£çµã€‘\n\nâ—ˆ å¾®ä¿¡ç¾¤ï¼šéˆæµè«–å£‡\nâ—ˆ åº§æ¨™ï¼šæ³°åœ‹ Â· æ›¼è°·\nâ—ˆ åˆä½œæ´½è©¢ï¼šè«‹é€éæ„è­˜æ³¢æ®µæˆ–ç§è¨Šè¯ç¹«éˆæµç‹‚å¾’ã€‚", 'b-msg');
        } else if(m === 'oracle') {
            inp.style.display = 'none';
            box.innerHTML = `<div style="text-align:center; padding:50px 0;"><button onclick="getOracle()" style="font-size:1.2rem; padding:20px 40px; border-radius:50px; background:var(--main); color:#000; font-weight:bold; box-shadow: 0 0 20px var(--main-dim);">â—ˆ æ„Ÿæ‡‰è™›æºç­”æ¡ˆ â—ˆ</button></div>`;
        } else if(m === 'spectrum') {
            loadSpectrum();
        }
    }

    // X-IOS æ¸¬é©—é‚è¼¯
    function startTest() {
        answers = "";
        const box = document.getElementById('chat-box');
        box.innerHTML = `<div class="test-card">
            <div id="q-text" style="margin-bottom:20px; font-size:1.1rem;">æ­£åœ¨è¼‰å…¥ X-IOS å‘½é‹åˆ¤è®€é¡Œåº«...</div>
            <div id="q-count" style="font-size:0.7rem; color:#444; margin-bottom:10px;">PROGRESS: 0 / 30</div>
            <div class="opt-grid">
                <button class="opt-btn" onclick="record('A')">é¸é … A</button>
                <button class="opt-btn" onclick="record('B')">é¸é … B</button>
                <button class="opt-btn" onclick="record('C')">é¸é … C</button>
                <button class="opt-btn" onclick="record('D')">é¸é … D</button>
            </div>
        </div>`;
        updateQ(1);
    }

    const questions = ["é‡åˆ°ä¸ç†Ÿçš„èšæœƒï¼Ÿ", "æœ‹å‹æå‡ºä¸åˆç†è«‹æ±‚ï¼Ÿ", "ç¾¤çµ„ç™¼è¨€æ²’äººå›ï¼Ÿ" /* æ­¤è™•å¯å¡«å¯« 30 é¡Œç°¡ç¨±æˆ–å®Œæ•´å…§å®¹ */];
    function updateQ(n) {
        document.getElementById('q-text').innerText = `ã€ç¬¬ ${n} é¡Œã€‘\n${questions[n-1] || "è«‹ä¾ç›´è¦ºé¸æ“‡ç›®å‰çš„è¡Œç‚ºæ…£æ€§"}`;
        document.getElementById('q-count').innerText = `PROGRESS: ${n} / 30`;
    }

    function record(val) {
        answers += val;
        if(answers.length < 30) {
            updateQ(answers.length + 1);
        } else {
            finishTest();
        }
    }

    async function finishTest() {
        const box = document.getElementById('chat-box');
        box.innerHTML = `<div class="msg b-msg">æ•¸æ“šå°è£å®Œæˆã€‚æ­£åœ¨å‘è™›æºå¤§è…¦è«‹æ±‚æ“Šç©¿å¼åˆ¤è®€...</div>`;
        const res = await fetch(URL, { method: "POST", body: JSON.stringify({ action: "diagnose", message: answers }) });
        const data = await res.json();
        box.innerHTML = `<div class="msg b-msg">${data.reply}</div>`;
    }

    // æ ¸å¿ƒåŸºç¤å‡½å¼
    async function execute() {
        const i = document.getElementById('userInput');
        const t = i.value.trim(); if(!t) return;
        append(t, 'u-msg'); i.value = '';
        const ldId = append("é »ç‡æƒæä¸­...", 'b-msg');
        const resp = await fetch(URL, { method: "POST", body: JSON.stringify({ action: "chat", message: t, module: currentMod }) });
        const data = await resp.json();
        document.getElementById(ldId).innerText = data.reply;
        const area = document.getElementById('content-area');
        area.scrollTop = area.scrollHeight;
    }

    async function getOracle() {
        const box = document.getElementById('chat-box');
        box.innerHTML = `<div class="msg b-msg" style="text-align:center;">é »ç‡åŒæ­¥ä¸­...</div>`;
        const res = await fetch(URL, { method: "POST", body: JSON.stringify({ action: "getOracle" }) });
        const data = await res.json();
        box.innerHTML = `<div class="msg b-msg" style="border:1px solid var(--main); padding:30px; text-align:center; background:rgba(0,242,255,0.02); border-radius:20px;">${data.reply}</div>`;
    }

    function append(t, c) {
        const id = "m-" + Date.now();
        document.getElementById('chat-box').innerHTML += `<div id="${id}" class="msg ${c}">${t}</div>`;
        return id;
    }

    // ğŸ¨ ç²’å­èƒŒæ™¯å¼•æ“
    const cvs = document.getElementById('p-canvas'); const ctx = cvs.getContext('2d');
    function resize() { cvs.width = window.innerWidth; cvs.height = window.innerHeight; }
    window.onresize = resize; resize();
    let ps = Array(80).fill().map(() => ({ x:Math.random()*cvs.width, y:Math.random()*cvs.height, s:Math.random()*0.8, o:Math.random()*0.5 }));
    function anim() {
        ctx.clearRect(0,0,cvs.width,cvs.height);
        ps.forEach(p => { 
            p.y -= 0.3; if(p.y < 0) p.y = cvs.height; 
            ctx.fillStyle = `rgba(0, 242, 255, ${p.o})`;
            ctx.beginPath(); ctx.arc(p.x, p.y, p.s, 0, 7); ctx.fill(); 
        });
        requestAnimationFrame(anim);
    }
    anim(); sw('declaration', 'è™›æºå®£è¨€');
</script>
</body>
</html>
