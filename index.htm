<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è™›æºéˆæµ V5 - éˆæµå°å¸«</title>
    <style>
        :root { --main: #00f2ff; --bg: #050505; --panel: #111; --text: #d1d1d1; }
        * { box-sizing: border-box; }
        body { background: #000; color: var(--text); font-family: sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }

        /* ğŸŒŒ èƒŒæ™¯ç²’å­ç•«å¸ƒ */
        #p-canvas { position: fixed; top: 0; left: 0; z-index: -1; pointer-events: none; }

        /* ğŸ“± æ‰‹æ©Ÿå°èˆªé ­éƒ¨ (åƒ…æ‰‹æ©Ÿé¡¯ç¤º) */
        .mobile-header { display: none; position: fixed; top: 0; left: 0; right: 0; height: 60px; background: rgba(0,0,0,0.9); border-bottom: 1px solid #222; align-items: center; padding: 0 20px; z-index: 1001; }
        .menu-btn { font-size: 1.5rem; color: var(--main); cursor: pointer; }

        /* å´é‚Šå°èˆªæ¬„ */
        .sidebar { width: 220px; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); border-right: 1px solid #222; display: flex; flex-direction: column; padding: 20px 0; transition: 0.3s; flex-shrink: 0; z-index: 1002; }
        .logo { color: var(--main); text-align: center; font-weight: 300; letter-spacing: 3px; margin-bottom: 30px; font-size: 1.2rem; }
        .menu-item { padding: 15px 25px; cursor: pointer; color: #666; font-size: 0.9rem; transition: 0.3s; border-left: 3px solid transparent; }
        .menu-item.active { color: var(--main); background: rgba(0, 242, 255, 0.05); border-left-color: var(--main); }

        /* ä¸»é¡¯ç¤ºå€ */
        .main { flex: 1; display: flex; flex-direction: column; background: rgba(5, 5, 5, 0.7); backdrop-filter: blur(8px); }
        header { padding: 15px 30px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; align-items: center; }
        #module-title { color: var(--main); letter-spacing: 2px; }

        #content-area { flex: 1; overflow-y: auto; padding: 30px; display: flex; flex-direction: column; scroll-behavior: smooth; }
        .msg { margin-bottom: 20px; line-height: 1.7; animation: slideIn 0.3s ease; }
        .u-msg { align-self: flex-end; color: #888; text-align: right; border-right: 2px solid #333; padding-right: 15px; }
        .b-msg { align-self: flex-start; border-left: 2px solid var(--main); padding-left: 15px; white-space: pre-wrap; }

        .input-area { padding: 20px 30px; border-top: 1px solid #222; background: rgba(0,0,0,0.9); display: flex; gap: 10px; }
        input { flex: 1; background: #1a1a1a; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 8px; outline: none; }
        button { background: var(--main); color: #000; border: none; padding: 0 20px; border-radius: 8px; cursor: pointer; font-weight: bold; }

        /* ğŸ“± æ‰‹æ©Ÿç«¯ RWD é©é… */
        @media (max-width: 768px) {
            .mobile-header { display: flex; }
            .sidebar { position: fixed; left: -220px; height: 100vh; }
            .sidebar.open { left: 0; }
            .main { padding-top: 60px; }
            .input-area { padding: 15px; }
            .msg { max-width: 95%; }
        }

        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<canvas id="p-canvas"></canvas>

<div class="mobile-header">
    <div class="menu-btn" onclick="toggleSidebar()">â˜°</div>
    <div style="flex:1; text-align:center; color:var(--main); letter-spacing:2px;">è™›æºéˆæµ</div>
</div>

<nav class="sidebar" id="sidebar">
    <div class="logo">è™›æºéˆæµ</div>
    <div class="menu-item active" onclick="sw('declaration', 'è™›æºå®£è¨€')">è™›æºå®£è¨€</div>
    <div class="menu-item" onclick="sw('spectrum', 'éˆæµå…‰è­œ')">éˆæµå…‰è­œ</div>
    <div class="menu-item" onclick="sw('oracle', 'ç­”æ¡ˆä¹‹æ›¸')">ç­”æ¡ˆä¹‹æ›¸</div>
    <div class="menu-item" onclick="sw('tarot', 'éˆæµå¡”ç¾…')">éˆæµå¡”ç¾…</div>
    <div class="menu-item" onclick="sw('daily', 'ä»Šæ—¥å»ºè­°')">ä»Šæ—¥å»ºè­°</div>
    <div class="menu-item" onclick="sw('test', 'äººæ ¼æ¸¬è©¦')">äººæ ¼æ¸¬è©¦</div>
    <div class="menu-item" onclick="sw('calibrate', 'å››ç­†æ³•æ ¡æº–')">å››ç­†æ³•æ ¡æº–</div>
</nav>

<div class="main">
    <header>
        <div id="module-title">è™›æºå®£è¨€</div>
        <div style="font-size: 0.6rem; color: #444;">BANGKOK TIME</div>
    </header>
    <div id="content-area"><div id="chat-box"></div></div>
    <div class="input-area" id="input-box">
        <input type="text" id="userInput" placeholder="è¼¸å…¥æŒ‡ä»¤..." onkeypress="if(event.key==='Enter')execute()">
        <button onclick="execute()">å‚³é€</button>
    </div>
</div>

<script>
    const URL = "https://script.google.com/macros/s/AKfycbxF3UMD2wvsOtrYKo33ptOW8VzrjQuMMDo-HABtrABDS80DMEZoFPwj-eLnVoa_KBva/exec"; 
    let currentMod = 'declaration';

    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }

    async function sw(m, t) {
        currentMod = m;
        document.getElementById('module-title').innerText = t;
        if(window.innerWidth <= 768) toggleSidebar();
        
        const box = document.getElementById('chat-box');
        const inp = document.getElementById('input-box');
        
        if(m === 'spectrum') {
            box.innerHTML = `<div class="msg b-msg">æ­£åœ¨æª¢ç´¢é˜¿å¡è¥¿ç›®éŒ„...</div>`;
            inp.style.display = 'flex';
            const res = await fetch(URL, { method: "POST", body: JSON.stringify({ action: "getList" }) });
            const data = await res.json();
            box.innerHTML = `<div class="msg b-msg">å·²åµæ¸¬é »ç‡æ¨™é¡Œï¼Œé»æ“Šé€²è¡Œæ ¡æº–ï¼š</div>`;
            data.list.forEach(n => {
                const b = document.createElement('button');
                b.innerText = `â—ˆ ${n}`;
                b.style = "display:block; width:100%; margin:10px 0; background:transparent; border:1px solid #333; color:var(--main); padding:10px; text-align:left; border-radius:8px;";
                b.onclick = () => { document.getElementById('userInput').value = `è§£æã€${n}ã€‘`; execute(); };
                box.appendChild(b);
            });
        } else if(m === 'oracle') {
            inp.style.display = 'none';
            box.innerHTML = `<div style="text-align:center; padding:50px 0;"><button onclick="getOracle()" style="font-size:1.2rem; padding:20px 40px; border-radius:50px; background:var(--main); color:#000; font-weight:bold;">â—ˆ é–‹å•Ÿç­”æ¡ˆ â—ˆ</button></div>`;
        } else {
            inp.style.display = 'flex';
            box.innerHTML = `<div class="msg b-msg">ç³»çµ±ï¼šå·²åˆ‡æ›è‡³ã€${t}ã€‘æ¨¡çµ„ã€‚</div>`;
        }
    }

    async function getOracle() {
        const box = document.getElementById('chat-box');
        box.innerHTML = `<div class="msg b-msg" style="text-align:center;">æ­£åœ¨é€£çµè™›æº...</div>`;
        const res = await fetch(URL, { method: "POST", body: JSON.stringify({ action: "getOracle" }) });
        const data = await res.json();
        box.innerHTML = `<div class="msg b-msg" style="border:1px solid var(--main); padding:20px; text-align:center;">${data.reply}</div>`;
    }

    async function execute() {
        const i = document.getElementById('userInput');
        const t = i.value.trim(); if(!t) return;
        append(t, 'u-msg'); i.value = '';
        const ldId = append("æ ¡æº–ä¸­...", 'b-msg');
        const resp = await fetch(URL, { method: "POST", body: JSON.stringify({ action: "chat", message: t, module: currentMod }) });
        const data = await resp.json();
        document.getElementById(ldId).innerText = data.reply;
        document.getElementById('content-area').scrollTop = document.getElementById('content-area').scrollHeight;
    }

    function append(t, c) {
        const id = "m-" + Date.now();
        document.getElementById('chat-box').innerHTML += `<div id="${id}" class="msg ${c}">${t}</div>`;
        return id;
    }

    // ğŸŒŠ ç²’å­èƒŒæ™¯å¼•æ“ (ç°¡ç´„ç‰ˆ)
    const cvs = document.getElementById('p-canvas'); const ctx = cvs.getContext('2d');
    function resize() { cvs.width = window.innerWidth; cvs.height = window.innerHeight; }
    window.onresize = resize; resize();
    let ps = Array(60).fill().map(() => ({ x:Math.random()*cvs.width, y:Math.random()*cvs.height, s:Math.random()*0.5 }));
    function anim() {
        ctx.clearRect(0,0,cvs.width,cvs.height);
        ctx.fillStyle = 'rgba(0, 242, 255, 0.3)';
        ps.forEach(p => { p.y -= 0.2; if(p.y < 0) p.y = cvs.height; ctx.beginPath(); ctx.arc(p.x, p.y, p.s, 0, 7); ctx.fill(); });
        requestAnimationFrame(anim);
    }
    anim(); sw('declaration', 'è™›æºå®£è¨€');
</script>
</body>
</html>
